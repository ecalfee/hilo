a# local ancestry calling

0) Before starting:
Call variant sites (variant_sites/)
Get genomewide ancestry prior for each pop from NGSAdmix (global_ancestry/)
Calculate allele frequencies & # included individuals for allopatric maize and mex (within_ancestry_diversity/)

1) Filter SNPs for 'informative' sites with > .3 alelle freq diff between allopatric maize and mexicana and minimum 10 individuals with data from each group
local_ancestry$ sbatch --export=PREFIX=pass2_alloMAIZE,D=0.3,MIN_MAIZE=10,MIN_MEX=10 filterAlloMAFnInd.sh
Submitted batch job 10490296 - redoing:
Submitted batch job 10490726 - RUNNING

2) Reduce LD by filter SNPs to minimum >.001 cM spacing
local_ancestry$ sbatch --dependency=afterok:10490726 pruneFixedcM_HMM.sh
Submitted batch job 10491135 - DIDN;T WORK - FORGOT PREFIX 4.26.19:
local_ancestry$ sbatch --export=PREFIX=pass2_alloMAIZE pruneFixedcM_HMM.sh
Submitted batch job 10495041

3a) Get allele counts for allopatric maize
# making VCF for allopatric maize
local_ancestry$ sbatch --export=PREFIX=pass2_alloMAIZE --dependency=afterok:10495041 getVCFforAllo.sh
Submitted batch job 10495391 - FAILED 4.26.19. fix typo:
local_ancestry$ sbatch --export=PREFIX=pass2_alloMAIZE getVCFforAllo.sh
Submitted batch job 10496067 - COMPLETED 4.27.19

# turning VCF into an allele counts file
local_ancestry$ sbatch --export=PREFIX=pass2_alloMAIZE --dependency=afterok:10495391 alloVCF2AlleleCounts.sh
Submitted batch job 10495392 - DEPENDENCY NOT MET 4.26.19. RETRY:
local_ancestry$ sbatch --export=PREFIX=pass2_alloMAIZE --dependency=afterok:10496067 alloVCF2AlleleCounts.sh
Submitted batch job 10496078 - COMPLETED 4.27.19

3b) Get read counts for all hilo individuals
ACGT counts:
local_ancestry$ sbatch -p med2 --array=0-217 --export="CHR=1,PREFIX=pass2_alloMAIZE,ALL" countReadsACGT.sh
Submitted batch job 10496223
local_ancestry$ for i in {2..19}; do sbatch -p med2 --array=0-217 --export="CHR=$i,PREFIX=pass2_alloMAIZE,ALL" countReadsACGT.sh; done
Submitted batch job 10496411..10496415 10496436..10496448 - COMPLETED 4.28.19

Major Minor allele counts:
local_ancestry$ sbatch --dependency=afterok:$(echo 10496223 {10496411..10496415} {10496436..10496448} | tr " " ",") --array=0-217 --export=PREFIX=pass2_alloMAIZE countReadsMajorMinor.sh
Submitted batch job 10496695 - COMPLETED 4.28.19

3c) Sample one read per allopatric mexicana as an 'allele' count & put together with allopatric maize allele counts
local_ancestry$ sbatch --export=PREFIX=pass2_alloMAIZE --array=1 makeAlloCountsAncHMMInput.sh
Submitted batch job 10500875 - COMPLETED
local_ancestry$ sbatch --export=PREFIX=pass2_alloMAIZE --array=2-10 makeAlloCountsAncHMMInput.sh
Submitted batch job 10500878 - COMPLETED 4.28.19 (fast)

4a) Get population mean mexicana ancestry (prior) and lists of included individuals per sympatric pop meeting some minimum coverage threshold, e.g. >.1x mean.
made iteractively in: global_ancestry/plot_NGSAdmix.R
globalAdmixtureByIncludedIndividual.txt
globalAdmixtureIncludedByPopN.txt

4b) Make input files; including global ancestry per pop. Only include sympatric individuals > threshold coverage
local_ancestry$ sbatch --export=PREFIX=pass2_alloMAIZE makeAncHMMInput.sh

5) Run ancestry_hmm for each population. Use NGSAdmix mean alpha_mex as initial prior
runAncHMM.sh
runAncHMM_noboot.sh
local_ancestry$ sbatch --export="Ne=10000,PREFIX=pass2_alloMAIZE,SUBDIR_OUT=output_noBoot,GLOBAL_ADMIXTURE_FILE=../global_ancestry/results/NGSAdmix/pass2_alloMAIZE/globalAdmixtureIncludedByPopN.txt" runAncHMM_noboot.sh


6) Test robustness by filtering counts down to a lower x coverage
